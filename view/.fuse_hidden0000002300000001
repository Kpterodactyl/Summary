<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="renderer" content="webkit">
	<base href="<?= URL('/') ?>" />
	<title><?php echo H(T("站点行为分析平台"))?></title>
	<link rel="stylesheet" href="assets/css/bootstrap.css" />
	<link rel="stylesheet" href="assets/css/font-awesome.min.css" />
	<link rel="stylesheet" type="text/css" href="assets/css/summary.css">
	<script data-main="assets/js/main.js" src="assets/js/require.js"></script>
	<link rel="shortcut icon" href="assets/img/favicon.png" type="image/png">
</head>
<body>
    <div class="container">
		<div class="row">
			<div class="col-xs-4 col-md-offset-1">
			<img src="assets/img/logo.png" style="padding-top:30px;margin-left:-32px;">
			</div>
			<div class="col-xs-7">
				<p style="color:black;font-size:42px;padding-top:22px;"><?php echo H(T("Lims站点行为监测"))?></p>
			</div>
	    </div>
		<div class="row" style="margin-top:10px;">
			<div class="col-xs-2">
				<ul id="myNav">
					<li class="active"><a href="/Summary/#loginpart"><i class="fa fa-area-chart" aria-hidden="true"></i><?php echo H(T("访问信息概况"))?></a></li>
		        	<li><a href="/Summary/#section-2"><?php echo H(T("访客属性"))?></a></li>
		        	<li><a href="/Summary/#section-3"><?php echo H(T("访客身份"))?></a></li>
	                <li><a href="/Summary/#section-4"><?php echo H(T("操作系统统计"))?></a></li>
	                <li><a href="/Summary/#section-5"><?php echo H(T("访客习惯统计"))?></a></li>
		        	<li><a href="/Summary/#section-6"><?php echo H(T("模块访问分析"))?></a></li>
		        	<li><a href="/Summary/#section-7"><?php echo H(T("访问行为分析"))?></a></li>
				</ul>
			</div>
	    	<div class="col-xs-10">
	        	<div id="loginpart">
	        	<h3><b><i class="fa fa-area-chart" aria-hidden="true"></i><?php echo H(T("访问信息概况"))?></b></h3>
	            	<table class="table">
						<tr style="background-color:  #CCEEFF;font: '微软雅黑';">
							<th></th>
							<th><?php echo H(T("访问量(PV)"))?></th>
							<th><?php echo H(T("访客数(UV)"))?></th>
							<th><?php echo H(T("平均访问时长(AVG)"))?></th>
							<th><?php echo H(T("IP数"))?></th>
						</tr>
						<tr>
							<td><?php echo H(T("今 日"))?></td>
							<td class="h4"><b><?=H($today_visit)?></b></td>
							<td class="h4"><b><?=H($today_user)?></b></td>
							<td class="h4"><b><?=H($today_avg_time)?></b></td>
							<td class="h4"><b><?=H($today_ip)?></b></td>	
						</tr>
						<tr>
							<td><?php echo H(T("昨 日"))?></td>
							<td><?=H($yday_visit)?></td>
							<td><?=H($yday_user)?></td>
							<td><?=H($yday_avg_time)?></td>
							<td><?=H($yday_ip)?></td>
						</tr>
						<tr>
							<td><?php echo H(T("近一周"))?></td>
							<td><?=H($week_visit)?></td>
							<td><?=H($week_user)?></td>
							<td><?=H($week_avg_time)?></td>
							<td><?=H($week_ip)?></td>
						</tr>
					</table>
				<div>
					<div id="line" style="height: 400px;"></div>
				</div>
	        	</div>
	        	<div id="section-2" class="container">
					<h3><b><i class="icon-cogs"></i><?php echo H(T("访问信息"))?></b></h3>
					
						<table id="tab" class="table table-hover">
			                <thead>
			                    <tr>
			                    	<th><?php echo H(T("站点"))?></th>
			                        <th><?php echo H(T("省份"))?></th>
			                        <th><?php echo H(T("城市"))?></th>
			                        <th><?php echo H(T("访问IP"))?></th>
			                        <th><?php echo H(T("浏览器"))?></th>
			                        <th><?php echo H(T("浏览器版本"))?></th>
			                        <th><?php echo H(T("操作系统"))?></th>
			                        <th><?php echo H(T("设备种类"))?></th>
			                        <th><?php echo H(T("登录时间"))?></th>
			                    </tr>
			                </thead>
							<tbody id="login_tab">
					        </tbody>	
						</table>
						<div style="float:right">
							<nav>
							  <ul class="pagination">
							    <li>
							      <a href="#" aria-label="Previous">	
							        <span aria-hidden="true">&laquo;</span>
							      </a>
							    </li>
								    <?php for($i=1;$i<=$total_page;$i++): ?>
								    	<li><a class="page" href="javascript:void(0)"><?=$i?></a></li>
								    <?php endfor;?>
							    <li>
							      <a href="#" aria-label="Next">
							        <span aria-hidden="true">&raquo;</span>
							      </a>
							    </li>
							  </ul>
							</nav>
						</div>
			    </div>
			    <div id="section-3" style="margin-top:30px; margin-bottom:30px;">
	        	<h3><b><i class="icon-user"></i><?php echo H(T("访客身份"))?></b></h3>
	            	<table class="table">
						<tr style="background-color:  #CCEEFF;font: '微软雅黑';">
							<th><?php echo H(T("访客身份"))?></th>
							<th><?php echo H(T("访问次数"))?></th>
							<th><?php echo H(T("所占比例"))?></th>
						</tr>
						<tr>
							<td><?php echo H(T("老 师"))?></td>
							<td><?=H($teacher_num)?></td>
							<td><?=H($teacher_scale)?></td>
							
						</tr>
						<tr>
							<td><?php echo H(T("学 生"))?></td>
							<td><?=H($student_num)?></td>
							<td><?=H($student_scale)?></td>
						</tr>
						<tr>
							<td><?php echo H(T("其 他"))?></td>
							<td><?=H($other_num)?></td>
							<td><?=H($other_scale)?></td>
							
						</tr>
					</table>
	        	</div>

			    <div id="section-4">
				<h3><b><i class="icon-reorder"></i><?php echo H(T("操作系统统计"))?></b></h3>
	                <div class="col-xs-6"  id="pie3" style="height: 400px;"></div>
					<div class="col-xs-6"  id="charts2" style="height:400px"></div>
				</div>
				<div id="section-5">
				<h3><b><i class="icon-heart"></i><?php echo H(T("退出习惯"))?></b></h3>
	            	<table class="table">
						<tr style="background-color:  #CCEEFF;font: '微软雅黑';">
							<th><?php echo H(T("退出方式"))?></th>
							<th><?php echo H(T("次数"))?></th>
							<th><?php echo H(T("所占比例"))?></th>
						</tr>
						<tr>
							<td><?php echo H(T("手 动"))?></td>
							<td><?=H($manual_num)?></td>
							<td><?=H($manual_scale)?></td>
							
						</tr>
						<tr>
							<td><?php echo H(T("自 动"))?></td>
							<td><?=H($auto_num)?></td>
							<td><?=H($auto_scale)?></td>
						</tr>
					</table> 
					<h3><b><i class="icon-heart-empty"></i><?php echo H(T("访客使用设备习惯"))?></b></h3>
	            	<table class="table">
						<tr style="background-color:  #CCEEFF;font: '微软雅黑';">
							<th><?php echo H(T("设备类别"))?></th>
							<th><?php echo H(T("次数"))?></th>
							<th><?php echo H(T("所占比例"))?></th>
						</tr>
						<tr>
							<td><?php echo H(T("电   脑"))?></td>
							<td><?=H($desktop_num)?></td>
							<td><?=H($desktop_scale)?></td>

						</tr>
						<tr>
							<td><?php echo H(T("移动设备"))?></td>
							<td><?=H($mobile_num)?></td>
							<td><?=H($mobile_scale)?></td>
						</tr>
						<tr>
							<td><?php echo H(T("Robot"))?></td>
							<td><?=H($robot_num)?></td>
							<td><?=H($robot_scale)?></td>
						</tr>
					</table>
				</div>

			    <div id="section-6">
				<h3><b><i class="icon-dashboard"></i><?php echo H(T("模块访问分析"))?></b></h3>
	                <div id="line2" style="height:400px"></div><hr>
				</div>
				 <div id="section-7">
				<h3><b><i class="icon-bar-chart"></i><?php echo H(T("访问行为分析"))?></b></h3>
	                <div id="line3" style="height:400px"></div><hr>
				</div>
	        </div>
	    </div>
    </div>
</body>
</html>
<script type="text/javascript">
require(['main'],function($){
	
		$("#myNav").affix({
			offset: { 
		    	top: 125 
				}
		});
		$.ajax({
			type:'POST',
			url:'ajax/summary/page/',
			dataType:"json",
			data:{},
			success:function(data){	
				data = JSON.parse(data);
				var content = "";
				for(var i=0;i<data.length;i++){

					content += "<tr>";
					content += "<td>"+ data[i].source_name + "</td>";
					content += "<td>"+ data[i].province + "</td>";
					content += "<td>"+ data[i].city + "</td>";
					content += "<td>"+ data[i].address + "</td>";
					content += "<td>"+ data[i].browser + "</td>";
					content += "<td>"+ data[i].b_version + "</td>";
					content += "<td>"+ data[i].OS_type +"</td>";
					content += "<td>"+ data[i].device_type +"</td>";
					content += "<td>"+ data[i].dtstart +"</td>";
					content += "</tr>";
				}
		
				$('#login_tab').html(content);
			}
		})
		$('#look').click();
		$('.page').click(function(){

			var page = $(this).text();
			$.ajax({
				type:'POST',
				url:'ajax/summary/page/'+page,
				dataType:"json",
				data:{},
				success:function(data){
					data = JSON.parse(data);
					content ="";
					for(var i=0;i<data.length;i++){ 
						content += "<tr>";
						content += "<td>"+ data[i].source_name + "</td>";
						content += "<td>"+ data[i].province + "</td>";
						content += "<td>"+ data[i].city + "</td>";
						content += "<td>"+ data[i].address + "</td>";
						content += "<td>"+ data[i].browser + "</td>";
						content += "<td>"+ data[i].b_version + "</td>";
						content += "<td>"+ data[i].OS_type +"</td>";
						content += "<td>"+ data[i].dtstart +"</td>";
						content += "</tr>";
					}

					$('#login_tab').html(content);
				}
			})
		})
    })
</script>
<script type="text/javascript">
require(['main'], function($) {
	require(['echarts'], function (ec) {
		//line是关于每日访问量的
		var SummaryChart = ec.init(document.getElementById('line'));
		//pie3 charts2是关于用户操作系统的
		var countBrowserChart = ec.init(document.getElementById('pie3'));
		var browserPie = ec.init(document.getElementById('charts2'));
		//line2 pie4是关于模块访问分析的
		var moduleChart = ec.init(document.getElementById('line2'));
		//countActionChart 是关于访问行为分析的
		var countActionChart = ec.init(document.getElementById('line3'));
	   $(function(){ 
			$.ajax({
				type:"POST",
				url:'ajax/summary/browseroption/',
				data:{},
				dataType:"json",
			    success:function(result){			   
				    data = JSON.parse(result);
			    	browserPie.setOption({
				        title: {
				            text: '用户各操作系统数量统计'
				        },
				        tooltip: {},
				        legend: {
				            data:['数量']
				        },
				        xAxis: {
				        	axisLabel: {
							    rotate: 60,
								show:true,
								interval: 0,
								},
				            data: data['name'],
				        },
				        yAxis: {},
				        series: [{
				            name: '用户类型',
				            type: 'bar',
				            data: data['count'],
				        }]
				    });
				}
			})
            //设备类型
            $.ajax({
				type:"POST",
				url:'ajax/summary/devicetype/',
				data:{},
				dataType:"json",
			    success:function(result){			   
				    data = JSON.parse(result);
				   	countBrowserChart.setOption({
				        title: {
				            text: '用户各操作系统数量统计',
				            x:'center'
				        },
				        tooltip: {
				        	trigger: 'item',
   							formatter: "{a} <br/>{b} : {c} ({d}%)"
				        },
				  		series : [{
				           	name: '访问来源',
				           	type: 'pie',
				           	radius : '55%',
				           	center: ['50%', '60%'],
				           	data: data
				        }],
           				itemStyle: {
			                emphasis: {
			                    shadowBlur: 10,
			                    shadowOffsetX: 0,
			                    shadowColor: 'rgba(0, 0, 0, 0.5)'
			                }
                    	}
                    })
			    }
			}) 
		
		    //每日访问量 折线图	
			    $.ajax({
			    	type:"POST",
			    	url: 'ajax/summary/overview/',
			    	data:{} ,
			    	dataType: "json",
			    	success:function(result){
			    	data = JSON.parse(result);
			    	var visit_time = [];
		    		var visit_count = [];
					$(data).each(function(index, val){
					visit_time.push(val[0]);
			    	visit_count.push(val[1]);	
			    		SummaryChart.setOption({
						    title : {
		        				text: '访问量数据概况',
		        				
		    				},
		    				tooltip : {
		        				trigger: 'axis'
		    				},
		    				legend: {
		        				data:['今天','上周同一时间']
		    				},
		    				toolbox: {
		        				show : true,
		        				feature : {
		            				mark : {show: true},
		            				dataView : {show: true, readOnly: false},
		            				magicType : {show: true, type: ['line', 'bar']},
		            				restore : {show: true},
		            				saveAsImage : {show: true}
		        				}
		    				},
		    				calculable : true,
		    				xAxis : [
		        			{
		            			type : 'category',
		            			axisLabel: {
							    rotate: 55,
								show:true,
								interval: 0,
								},
		            			boundaryGap : false,
		            			data : visit_time,
		        			}
		    				 ],
		   					yAxis : [
		        			{
		            			type : 'value',
		            			axisLabel : {
		                			formatter: '{value}'
		            			}
		        			}
		    			],
		    			series : [
			        		{
			            		name:'每日访问量',
			            		type:'line',
			            		data: visit_count,
			            		markPoint : {
			                	data : [
			                    	{type : 'max', name: '最大值'},
			                    	{type : 'min', name: '最小值'}
			                	]
			            	},
			            	markLine : {
			                	data : [
			                    	{type : 'average', name: '平均值'}
			                	]
			            	}
			        		}
			    		]
					});
				})
			}
		    })
            
            //访问行为统计	
			    $.ajax({
			    	type:"POST",
			    	url: 'ajax/summary/countaction/',
			    	data:{} ,
			    	dataType: "json",
			    	success:function(result){
			    	data = JSON.parse(result);
			    		countActionChart.setOption({
						    title : {
		        				text: '用户行为概况',
		        				
		    				},
		    				tooltip : {
		        				trigger: 'axis'
		    				},
		    				toolbox: {
		        				show : true,
		        				feature : {
		            				mark : {show: true},
		            				dataView : {show: true, readOnly: false},
		            				magicType : {show: true, type: ['line', 'bar']},
		            				restore : {show: true},
		            				saveAsImage : {show: true}
		        				}
		    				},
		    				calculable : true,
		    				xAxis : [
		        			{
		            			type : 'category',
		            			axisLabel: {
							    rotate: 20,
								show:true,
								height:80,
								interval: 0,
								},
		            			boundaryGap : false,
		            			data : data['name'],
		        			}
		    				 ],
		    				grid: { // 控制图的大小，调整下面这些值就可以，
             					x: 40,
            					x2: 100,
             					y2: 130,// y2可以控制 X轴跟Zoom控件之间的间隔，避免以为倾斜后造成 label重叠到zoom上
         					},
		   					yAxis : [
		        			{
		            			type : 'value',
		            			axisLabel : {
		                			formatter: '{value}'
		            			}
		        			}
		    			],
		    			series : [
			        		{
			            		name:'本操作执行次数',
			            		type:'line',
			            		data: data['count'],
			            		markPoint : {
			                	data : [
			                    	{type : 'max', name: '最大值'},
			                    	{type : 'min', name: '最小值'}
			                	]
			            	},
			            	markLine : {
			                	data : [
			                    	{type : 'average', name: '平均值'}
			                	]
			            	}
			        		}
			    		]
					});
				}
			
		    })
     
            //模块统计折线图
		    $.ajax({
		    	type:"POST",
		    	url: 'ajax/summary/countmodule/',
		    	data:{} ,
		    	dataType: "json",
		    	success:function(result){
		    		
		    		data = JSON.parse(result);

		    		moduleChart.setOption({
					    title : {
	        				text: '模块访问数据',
	        				
	    				},
	    				tooltip : {
	        				trigger: 'axis'
	    				},
	    				legend: {
	        				data:['访问次数']
	    				},
	    				toolbox: {
	        				show : true,
	        				feature : {
	            				mark : {show: true},
	            				dataView : {show: true, readOnly: false},
	            				magicType : {show: true, type: ['line', 'bar']},
	            				restore : {show: true},
	            				saveAsImage : {show: true}
	        				}
	    				},
	    				calculable : true,
	    				xAxis : [
	    				
	        			{
	            			type : 'category',
	            			    axisLabel: {
							    rotate: 60,
								show:true,
								interval: 0,
								},
			            	boundaryGap : false,
	            			data: data['module'],
	        			}
	    				 ],
	   					yAxis : [
	        			{
	            			type : 'value',
	            			axisLabel : {
	                			formatter: '{value}'
	            			}
	        			}
	    			],
	    			series : [
	        		{
	            		name:'访问量',
	            		type:'line',
	            		data: data['count'],
	            		markPoint : {
	                	data : [
	                    	{type : 'max', name: '最大值'},
	                    	{type : 'min', name: '最小值'}
	                	]
	            	},
	            	markLine : {
	                	data : [
	                    	{type : 'average', name: '平均值'}
	                	]
	            	}
	        		}
	    			]
					});

		    	}
		    })

	    });
	    
    })
})
</script>



